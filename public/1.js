(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{28:function(e,t,i){"use strict";i.r(t);var s=i(2),o=i(1),n=i.n(o);function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var r={data:function(){return{headers:[{text:"ID",value:"id"},{text:"Nombre",value:"name"},{text:"Correo",value:"email"},{text:"Perfil",value:"role.name"},{text:"Sucursal",value:"stor_name"},{text:"",value:"estado"},{text:"",value:"action"}],show:!1,users:[],user:[],roles:[],permissions:[],selectedPermissions:[],errors:[],editingText:"",editingMode:!1,action:null,selectedModel:null,selectedRole:null,selectedUser:null,assignRole:!1,dialog:!1,dialogNegocio:!1,snackbar:!1,textMsg:"",timeout:2e3,idAdminBusiness:0,selectStore:0,stores:"",editado:{id:"",name:"",email:"",password:"",verified:0},editadoTemp:{id:"",name:"",email:"",password:"",verified:0},editadoDefault:{id:"",name:"",email:"",password:"",verified:0},editadoBusiness:{id:"",name:"",email:"",password:"",checkB:!1,idBusiness:0,verified:0},business:[],selectBusiness:""}},created:function(){this.getUser(),this.getUsers(),this.getRoles(),this.getPermissions(),this.getstores()},methods:{abrirdialog:function(){this.dialog=!0,this.editado.email="",console.log(this.editado)},getstores:function(){var e=this;axios.get("/storeget").then((function(t){e.stores=t.data.data,console.log(e.stores)})).catch((function(t){e.errors.push(t)}))},getUser:function(){var e=this;axios.get("/listUser").then((function(t){e.user=t.data.data})).catch((function(e){console.log(e)}))},getBusiness:function(e){var t=this;e||(e=0),axios.get("/getBusiness/"+e).then((function(e){t.business=e.data.data,console.log(t.business)})).catch((function(e){console.log(e)}))},changeBusiness:function(e){this.getBusiness(e)},getUserBusiness:function(e){var t=this;axios.get("/usuarioBusiness/"+e).then((function(e){t.idAdminBusiness=e.data.data.store_id,console.log(t.idAdminBusiness),0==t.idAdminBusiness?t.editadoBusiness.checkB=!1:(t.editadoBusiness.checkB=!0,t.selectStore=t.idAdminBusiness),t.dialogNegocio=!0})).catch((function(e){console.log(e)}))},saveUserRole:function(){var e=this;axios.post("/admins/"+this.selectedUser.id+"/role",{role_id:this.selectedRole}).then((function(t){e.users.splice(e.users.indexOf(e.users.find((function(t){return t.id===e.selectedUser.id}))),1,t.data.data),e.assignRole=!1,e.selectedUser=null,e.selectedRole=!1,e.normal("Notificación","¡Actualizado correctamente!","success")})).catch((function(t){e.errors.push(t)}))},saveUserPermissions:function(){var e=this;axios.post("/admins/"+this.selectedModel.id+"/permissions",this.selectedPermissions).then((function(t){e.users.splice(e.users.indexOf(e.users.find((function(t){return t.id===e.selectedModel.id}))),1,t.data.data),e.normal("Notificación","¡Actualizado correctamente!","success")})).catch((function(t){e.errors.push(t)})),this.editingMode=!1},saveRolePermissions:function(){var e=this;axios.post("/roles/"+this.selectedModel.id+"/permissions",this.selectedPermissions).then((function(t){e.roles.splice(e.users.indexOf(e.users.find((function(t){return t.id===e.selectedModel.id}))),1,t.data.data),e.normal("Notificación","¡Actualizado correctamente!","success")})).catch((function(t){e.errors.push(t)})),this.editingMode=!1},getUsers:function(){var e=this;axios.get("/users").then((function(t){e.users=t.data.data})).catch((function(t){e.errors.push(t)}))},getRoles:function(){var e=this;axios.get("/roles").then((function(t){e.roles=t.data.data})).catch((function(t){e.errors.push(t)}))},getPermissions:function(){var e=this;axios.get("/permissions").then((function(t){e.permissions=t.data.data})).catch((function(t){e.errors.push(t)}))},cancelar:function(){this.dialog=!1,this.editado=Object.assign({},this.editadoDefault),this.editedIndex=-1},guardar:function(){this.editedIndex>-1?(this.textMsg="¡Actualización Exitosa!",this.snackbar=!0,this.editarAdmin(),this.cancelar()):(this.textMsg="¡Alta exitosa!",this.snackbar=!0,this.addAdmin(),this.cancelar()),this.cancelar()},editar:function(e){this.editedIndex=this.users.indexOf(e),this.editadoTemp=Object.assign({},e),this.editado.id=this.editadoTemp.id,this.editado.name=this.editadoTemp.name,this.editado.email=this.editadoTemp.email,this.editado.verified=this.editadoTemp.verified,this.editado.password="",console.log(this.editado),this.dialog=!0},editarNegocio:function(e){this.editedIndex=this.users.indexOf(e),this.editadoTemp=Object.assign({},e),this.getUserBusiness(this.editadoTemp.id),this.editadoBusiness.id=this.editadoTemp.id,this.editadoBusiness.name=this.editadoTemp.name,this.editadoBusiness.email=this.editadoTemp.email,this.editadoBusiness.password=""},cancelarNegocio:function(){this.dialogNegocio=!1,this.editado=Object.assign({},this.editadoDefault),this.editedIndex=-1},guardarNegocio:function(){this.editarBusAdmin(),this.cancelarNegocio()},addAdmin:function(){var e=this;axios.post("/admin/add",this.editado).then((function(t){e.normal("Notificación","¡Actualizado correctamente!","success"),e.getUsers()}))},editarAdmin:function(){var e=this;axios.post("/admin/update",this.editado).then((function(t){e.normal("Notificación","¡Actualizado correctamente!","success"),e.getUsers()}))},editarBusAdmin:function(){var e=this;this.editadoBusiness.checkB?this.editadoBusiness.idBusiness=this.selectStore.stor_pk:this.editadoBusiness.idBusiness=0,axios.post("/admin/updateBusiness",this.editadoBusiness).then((function(t){e.normal("Notificación","¡Actualizado correctamente!","success"),e.getUsers()}))},desactivarUsuario:function(e){var t=this;this.editado=Object.assign({},e),0==this.editado.verified?this.editado.verified=1:this.editado.verified=0,axios.post("/admin/update",this.editado).then((function(e){200==e.status?(t.normal("Notificación","¡Actualizado correctamente!","success"),t.getUsers()):t.normal("Notificación",e.data.message,"error")})).catch((function(e){t.errors.push(e)}))},normal:function(e,t,i){this.notice=new n.a({title:e,description:t,className:"open-normal",closable:!0,duration:3,type:i})}},computed:function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},Object(s.b)("auth",["can"]))},d=i(0),l=Object(d.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-container",[i("v-snackbar",{attrs:{timeout:e.timeout},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(e._s(e.textMsg)+"\r\n        "),i("v-btn",{attrs:{color:"blue",text:""},on:{click:function(t){e.snackbar=!1}}},[e._v("Cerrar ")])],1),e._v(" "),i("v-row",[i("v-col",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.users,"item-key":"id"},scopedSlots:e._u([{key:"top",fn:function(){return[i("v-system-bar",{attrs:{color:"indigo darken-2",dark:""}}),e._v(" "),i("v-toolbar",{attrs:{flat:"",color:"indigo"},scopedSlots:e._u([{key:"extension",fn:function(){return[i("v-btn",{attrs:{fab:"",color:"cyan accent-2",bottom:"",left:"",absolute:""},on:{click:function(t){return e.abrirdialog()}}},[i("v-icon",[e._v("mdi-plus")])],1)]},proxy:!0}])},[e._v(" "),i("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),e._v(" "),i("v-spacer")],1)]},proxy:!0},{key:"item.estado",fn:function(t){return[1==t.item.verified?i("v-chip",{attrs:{color:"red",dark:""}},[e._v("Desactivado")]):i("v-chip",{attrs:{color:"green",dark:""}},[e._v("Activado")])]}},{key:"item.action",fn:function(t){var s=t.item;return[i("v-btn",{attrs:{small:"",icon:"",fab:"",color:"blue",title:"Editar usuario"},on:{click:function(t){return e.editar(s)}}},[i("v-icon",[e._v("mdi-account-edit")])],1),e._v(" "),i("v-btn",{attrs:{small:"",icon:"",fab:"",color:"blue",title:"Editar negocio"},on:{click:function(t){return e.editarNegocio(s)}}},[i("v-icon",[e._v("mdi-store-outline")])],1),e._v(" "),i("v-btn",{attrs:{small:"",icon:"",fab:"",color:"success",title:"Asignar rol"},on:{click:function(t){e.selectedModel=s,e.assignRole=!0,e.selectedUser=s,e.selectedRole=s.role_id}}},[i("v-icon",[e._v("mdi-account-key")])],1),e._v(" "),0==s.verified?i("v-btn",{attrs:{small:"",icon:"",fab:"",color:"error",title:"Desactivar usuario"},on:{click:function(t){return e.desactivarUsuario(s)}}},[i("v-icon",[e._v("mdi-account-off")])],1):e._e(),e._v(" "),1==s.verified?i("v-btn",{attrs:{small:"",icon:"",fab:"",color:"green",title:"Activar usuario"},on:{click:function(t){return e.desactivarUsuario(s)}}},[i("v-icon",[e._v("mdi-account-off")])],1):e._e()]}}])})],1)],1),e._v(" "),i("v-row",[i("v-col",{attrs:{cols:"6"}},[e.can("role")?i("v-card",[i("v-list",{attrs:{dense:""}},[i("v-list-item-group",{attrs:{color:"info"},model:{value:e.selectedRole,callback:function(t){e.selectedRole=t},expression:"selectedRole"}},[i("v-card-title",[e._v("Roles")]),e._v(" "),e.selectedUser?i("v-card-subtitle",{domProps:{textContent:e._s(e.selectedUser.name)}}):e._e(),e._v(" "),e._l(e.roles,(function(t){return i("v-list-item",{key:t.id,attrs:{"two-line":"",value:t.id},on:{click:function(i){e.selectedModel=t,e.selectedPermissions=t.permissions.map((function(e){return e.id})),e.editingText=t.name,e.editingMode=!1}}},[i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:e._s(t.name)}}),e._v(" "),i("v-list-item-subtitle",{domProps:{textContent:e._s(t.description)}})],1),e._v(" "),i("v-list-item-icon",[i("v-btn",{attrs:{color:"warning",icon:"",title:"Editar permisos de role"},on:{click:function(i){i.stopPropagation(),e.selectedModel=t,e.selectedPermissions=t.permissions.map((function(e){return e.id})),e.editingText=t.name,e.editingMode=!0,e.action=e.saveRolePermissions}}},[i("v-icon",[e._v("mdi-pencil-lock")])],1),e._v(" "),i("v-btn",{attrs:{color:"error",icon:"",title:"Eliminar role"}},[i("v-icon",[e._v("mdi-delete")])],1)],1)],1)}))],2)],1),e._v(" "),e.assignRole?i("v-card-actions",[i("v-btn",{attrs:{text:"",color:"success"},on:{click:e.saveUserRole}},[e._v("Asignar")]),e._v(" "),i("v-btn",{attrs:{text:"",color:"error"},on:{click:function(t){e.assignRole=!1,e.selectedUser=null}}},[e._v("Cancelar")])],1):e._e()],1):e._e()],1),e._v(" "),i("v-col",[e.can("permission")?i("v-card",[i("v-card-title",[e._v("Permisos")]),e._v(" "),i("v-card-subtitle",{domProps:{textContent:e._s(e.editingText)}}),e._v(" "),i("v-treeview",{attrs:{dense:"",items:e.permissions,"selection-type":"independent",selectable:"","open-on-click":"","open-all":"","item-key":"id","item-text":"description","item-children":"permissions"},model:{value:e.selectedPermissions,callback:function(t){e.selectedPermissions=t},expression:"selectedPermissions"}}),e._v(" "),e.editingMode?i("v-card-actions",[i("v-btn",{attrs:{color:"success",text:""},on:{click:e.action}},[e._v("Guardar")]),e._v(" "),i("v-btn",{attrs:{color:"error",text:""},on:{click:function(t){e.editingText="",e.editingMode=!1,e.selectedPermissions=[]}}},[e._v("Cancelar")])],1):e._e()],1):e._e()],1)],1),e._v(" "),i("v-dialog",{attrs:{"max-width":"640px",persistent:""},scopedSlots:e._u([{key:"activator",fn:function(e){e.on}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e._v(" "),i("v-card",[i("v-card-title",{staticClass:"cyan white--text"},[i("span",{staticClass:"headline"},[e._v("Administración")])]),e._v(" "),i("v-card-text",[i("v-text-field",{attrs:{label:"Nombre"},model:{value:e.editado.name,callback:function(t){e.$set(e.editado,"name",t)},expression:"editado.name"}}),e._v(" "),i("v-text-field",{attrs:{label:"Correo Electrónico"},model:{value:e.editado.email,callback:function(t){e.$set(e.editado,"email",t)},expression:"editado.email"}}),e._v(" "),i("v-text-field",{attrs:{"append-icon":e.show?"mdi-eye":"mdi-eye-off",type:e.show?"text":"password",label:"Contraseña"},on:{"click:append":function(t){e.show=!e.show}},model:{value:e.editado.password,callback:function(t){e.$set(e.editado,"password",t)},expression:"editado.password"}})],1),e._v(" "),i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"blue-grey"},on:{click:e.cancelar}},[e._v("\r\n                    Cancelar\r\n                ")]),e._v(" "),i("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"teal accent-4"},on:{click:e.guardar}},[e._v("\r\n                    Guardar\r\n                ")])],1)],1)],1),e._v(" "),i("v-dialog",{attrs:{"max-width":"640px"},scopedSlots:e._u([{key:"activator",fn:function(e){e.on}}]),model:{value:e.dialogNegocio,callback:function(t){e.dialogNegocio=t},expression:"dialogNegocio"}},[e._v(" "),i("v-card",[i("v-card-title",{staticClass:"cyan white--text"},[i("span",{staticClass:"headline"},[e._v("Administración")])]),e._v(" "),i("v-card-text",[i("v-checkbox",{attrs:{label:"Asignar negocio"},model:{value:e.editadoBusiness.checkB,callback:function(t){e.$set(e.editadoBusiness,"checkB",t)},expression:"editadoBusiness.checkB"}}),e._v(" "),i("v-select",{attrs:{items:e.stores,label:"Seleccione una tienda","single-line":"","item-text":"stor_name","item-value":"stor_pk","return-object":"","persistent-hint":""},model:{value:e.selectStore,callback:function(t){e.selectStore=t},expression:"selectStore"}})],1),e._v(" "),i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"blue-grey"},on:{click:e.cancelarNegocio}},[e._v("\r\n                    Cancelar\r\n                ")]),e._v(" "),i("v-btn",{staticClass:"ma-2 white--text",attrs:{color:"teal accent-4"},on:{click:e.guardarNegocio}},[e._v("\r\n                    Guardar\r\n                ")])],1)],1)],1)],1)}),[],!1,null,null,null);t.default=l.exports}}]);